<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Citizen Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="blockchain_engine.js"></script> <style>
    /* ... (Keep your existing styles from the uploaded file) ... */
    /* Add this for dynamic cards */
    .dynamic-card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; }
    .dynamic-card h4 { margin: 0 0 10px 0; color: #1e3a8a; }
    .badge { background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }
    
    /* Re-using your styles */
    body { font-family: 'Inter', system-ui; background: #f3f4f6; display: flex; justify-content: center; padding: 20px; }
    .dash-container { width: 100%; max-width: 900px; display: grid; gap: 20px; }
    .header-card { background: white; padding: 1.5rem; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .menu-card { background: white; padding: 2rem; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; }
    .menu-card:hover { border-color: #2563eb; }
    .voting-section { background: white; padding: 2rem; border-radius: 12px; display: none; }
    .vote-btn { width: 100%; padding: 10px; margin-top: 10px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; }
    .vote-btn:hover { background: #1d4ed8; }
  </style>
</head>
<body>

  <div class="dash-container">
    
    <div class="header-card">
      <div>
        <h2 style="margin:0;">Citizen Dashboard</h2>
        <small>ID Hash: <span id="user-hash-display">Loading...</span></small>
      </div>
      <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer;">Sign Out</button>
    </div>

    <div id="main-menu" class="menu-grid">
      <div class="menu-card" onclick="loadTendersView()">
        <h3>üó≥Ô∏è View Active Tenders</h3>
        <p>Vote for contractors on live government tenders.</p>
      </div>
      <div class="menu-card" onclick="alert('Audit Feature Coming Soon')">
        <h3>‚úÖ Audit Projects</h3>
        <p>Verify completion of ongoing works.</p>
      </div>
    </div>

    <div id="tender-section" class="voting-section">
      <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h3>Active Government Tenders</h3>
        <button onclick="showMenu()" style="padding:5px 10px;">Back</button>
      </div>
      
      <div id="tender-list-container"></div>
    </div>

  </div>

  <script>
    // 1. Auth Check
    const userHash = sessionStorage.getItem('active_user_hash');
    if (!userHash) window.location.href = 'user_login.html';
    document.getElementById('user-hash-display').textContent = userHash.substring(0, 10) + "...";

    // 2. Navigation
    function showMenu() {
        document.getElementById('tender-section').style.display = 'none';
        document.getElementById('main-menu').style.display = 'grid';
    }

    // 3. LOAD DATA FROM BLOCKCHAIN
    function loadTendersView() {
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('tender-section').style.display = 'block';
        
        const container = document.getElementById('tender-list-container');
        container.innerHTML = "<p>Scanning Blockchain Ledger...</p>";

        // Fetch Tenders using our Engine
        const tenders = GovChain.getAllTenders();

        if (tenders.length === 0) {
            container.innerHTML = "<p>No active tenders found on-chain.</p>";
            return;
        }

        let html = "";
        tenders.forEach(tender => {
            html += `
                <div class="dynamic-card">
                    <div style="display:flex; justify-content:space-between;">
                        <h4>${tender.title}</h4>
                        <span class="badge">${tender.jurisdiction}</span>
                    </div>
                    <p style="color:#666; font-size:0.9rem;">${tender.scope}</p>
                    <p><strong>Budget:</strong> ‚Çπ${tender.budget} Cr</p>
                    
                    <div style="margin-top:10px; display:flex; gap:10px;">
                        <button class="vote-btn" onclick="voteOnChain('${tender.id}', 'InfraCorp')">Vote: InfraCorp</button>
                        <button class="vote-btn" onclick="voteOnChain('${tender.id}', 'BuildWell')">Vote: BuildWell</button>
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    // 4. VOTE ON CHAIN
    function voteOnChain(tenderId, choice) {
        if(confirm(`Confirm vote for ${choice} on Tender ${tenderId}?`)) {
            
            const voteData = {
                voterHash: userHash,
                tenderId: tenderId,
                choice: choice,
                timestamp: new Date().toISOString()
            };

            // UPLOAD VOTE TO BLOCKCHAIN
            const block = GovChain.addData('VOTE', voteData);

            alert(`Vote Mined Successfully!\nBlock Hash: ${block.hash}`);
        }
    }

    function logout() {
        sessionStorage.clear();
        window.location.href = 'user_login.html';
    }
  </script>
</body>
</html>