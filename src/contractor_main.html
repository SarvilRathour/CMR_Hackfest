<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Contractor Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="blockchain_engine.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #1e3a8a; margin-top: 0; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #475569; }
        input, select { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #cbd5e1; box-sizing: border-box; }
        
        button { width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        
        .preview-box { width: 100%; height: 200px; background: #f1f5f9; border: 2px dashed #cbd5e1; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; border-radius: 4px; overflow: hidden; }
        .preview-img { max-width: 100%; max-height: 100%; display: none; }
        
        .status-box { background: #f0fdf4; color: #166534; padding: 10px; border-radius: 4px; margin-top: 15px; display: none; word-break: break-all; font-family: monospace; border: 1px solid #bbf7d0; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Contractor Upload Portal</h2>
    
    <label>Select Project</label>
    <select id="c_project">
        <option value="Highway Expansion (NH-44)">Highway Expansion (NH-44)</option>
        <option value="City Hospital Wing A">City Hospital Wing A</option>
        <option value="Metro Line Phase 2">Metro Line Phase 2</option>
    </select>

    <label>Phase Update Note</label>
    <input type="text" id="c_note" placeholder="e.g. Foundation Level 1 Complete">

    <label>Site Photo Evidence</label>
    <input type="file" id="c_file" accept="image/*" onchange="previewImage()">
    
    <div class="preview-box">
        <span id="placeholder-text" style="color:#94a3b8;">Image Preview</span>
        <img id="img_preview" class="preview-img">
    </div>

    <button onclick="uploadEvidence()">Upload Evidence to Blockchain</button>
    
    <div id="c_msg" class="status-box"></div>
</div>

<script>
    let base64Img = "";

    function previewImage() {
        const file = document.getElementById('c_file').files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            base64Img = e.target.result;
            const img = document.getElementById('img_preview');
            img.src = base64Img;
            img.style.display = 'block';
            document.getElementById('placeholder-text').style.display = 'none';
        }
        
        if(file) reader.readAsDataURL(file);
    }

    function uploadEvidence() {
        if(!base64Img) return alert("Please select an image first.");
        const note = document.getElementById('c_note').value;
        
        const data = {
            contractor: "CNTR-8821",
            project: document.getElementById('c_project').value,
            note: note || "Phase Update",
            image: base64Img
        };

        const block = GovChain.addData('EVIDENCE', data);

        const msg = document.getElementById('c_msg');
        msg.style.display = 'block';
        msg.innerHTML = `<strong>Success: Evidence Mined</strong><br>Block Index: ${block.index}<br>Hash: ${block.hash}`;
    }
</script>
</body>
</html>