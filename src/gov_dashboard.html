<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Government Admin Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="blockchain_engine.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #1e3a8a; margin-top: 0; }
        h3 { color: #334155; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; margin-top: 30px; }
        
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 6px; border: 1px solid #cbd5e1; box-sizing: border-box; font-size: 14px; }
        
        button { width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #1d4ed8; }
        
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .secondary-btn { background: #475569; width: auto; padding: 8px 16px; font-size: 14px; }
        
        .status-box { background: #f0fdf4; color: #166534; padding: 15px; border-radius: 6px; margin-top: 15px; display: none; word-break: break-all; font-family: monospace; border: 1px solid #bbf7d0; }
        
        .evidence-card { border: 1px solid #e2e8f0; padding: 15px; margin-bottom: 15px; display: flex; gap: 20px; border-radius: 6px; background: #fff; }
        .evidence-img { width: 150px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid #ccc; background: #f1f5f9; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <h2>Government Dashboard</h2>
        <button class="secondary-btn" onclick="GovChain.viewLedger()">View Blockchain Ledger</button>
    </div>

    <h3>Publish New Tender</h3>
    <label>Project Title</label>
    <input type="text" id="t_title" placeholder="e.g. Metro Line Phase 2">
    
    <label>Jurisdiction Type</label>
    <select id="t_jur">
        <option value="Urban Infrastructure">Urban Infrastructure</option>
        <option value="Rural Development">Rural Development</option>
        <option value="Transport">Transport & Highways</option>
    </select>
    
    <label>Scope of Work</label>
    <textarea id="t_scope" rows="3" placeholder="Describe the project details..."></textarea>
    
    <label>Budget (INR Crores)</label>
    <input type="number" id="t_budget" placeholder="e.g. 500">
    
    <button onclick="publishTender()">Mine Block & Publish Tender</button>
    <div id="tender-msg" class="status-box"></div>

    <h3>Contractor Evidence Feed</h3>
    <button class="secondary-btn" style="width: 100%; margin-bottom: 15px;" onclick="loadEvidence()">Refresh Blockchain Data</button>
    <div id="feed-area"></div>
</div>

<script>
    function publishTender() {
        const title = document.getElementById('t_title').value;
        const type = document.getElementById('t_jur').value;
        const scope = document.getElementById('t_scope').value;
        const budget = document.getElementById('t_budget').value;

        if(!title || !budget) return alert("Please fill in all fields.");

        const data = {
            id: "TND-" + Math.floor(Math.random() * 10000),
            title: title,
            type: type,
            scope: scope,
            budget: budget,
            status: "OPEN"
        };

        const block = GovChain.addData('TENDER', data);
        
        const msg = document.getElementById('tender-msg');
        msg.style.display = 'block';
        msg.innerHTML = `<strong>Tender Published Successfully</strong><br>Block Index: ${block.index}<br>Hash: ${block.hash}`;
        
        // Clear inputs
        document.getElementById('t_title').value = "";
        document.getElementById('t_scope').value = "";
        document.getElementById('t_budget').value = "";
    }

    function loadEvidence() {
        const chain = GovChain.getChain();
        const evidenceBlocks = chain.filter(b => b.type === 'EVIDENCE');
        const container = document.getElementById('feed-area');
        
        if(evidenceBlocks.length === 0) {
            container.innerHTML = "<p style='color:#64748b; text-align:center;'>No evidence uploaded to the blockchain yet.</p>";
            return;
        }

        container.innerHTML = evidenceBlocks.reverse().map(b => `
            <div class="evidence-card">
                <img src="${b.data.image}" class="evidence-img">
                <div>
                    <h4 style="margin: 0 0 5px 0;">${b.data.project}</h4>
                    <p style="margin: 0 0 10px 0; color: #334155;">${b.data.note}</p>
                    <div style="font-size: 12px; color: #64748b; font-family: monospace;">
                        Contractor: ${b.data.contractor}<br>
                        Hash: ${b.hash.substring(0, 30)}...
                    </div>
                </div>
            </div>
        `).join('');
    }
</script>
</body>
</html>